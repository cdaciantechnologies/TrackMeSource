<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vehicle Service View</title>
    <link href="css/css.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="css/buttons.dataTables.min.css" rel="stylesheet">
	
<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
<script type="text/javascript" src="js/tether.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/angular.min.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="js/dataTables.bootstrap.min.js"></script>

<script type="text/javascript" src="js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="js/buttons.flash.min.js"></script>
<script type="text/javascript" src="js/jspdf.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.4/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="js/icheck.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5S4p1X2ItBi2COzuPMC1NQbopFWmESAE"
    async defer></script>

</head>
<body class="top-navigation" onload="loadMap()">
    <div id="wrapper">
        <div class="navbar-fixed-top">
            <div class="row">
                <div class="col-xs-3 col-sm-3"><a href="#" class="logo-img">
                    <img src="" alt="" /></a></div>
                <div class="col-xs-6 col-sm-6 text-center">
                    <div class="top-title">VEHICLE TRACKING AND FLEET MANAGMENT SYSTEM</div>
                </div>
                <div class="col-xs-3 col-sm-3 text-right">
                    <div class="cust-logo">
                        <img src="images/cust-logo.jpg" alt="" />
                        <span>Customer Logo</span> </div>
                </div>
            </div>
            <div class="row border-bottom white-bgx">
                <div class="col-xs-12">
                    <nav class="navbar navbar-static-top" role="navigation">
				  <div class="navbar-header">
					<button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button"> <i class="fa fa-reorder"></i> </button> 
				  </div>
				   <div class="navbar-collapse collapse" id="navbar">
					<ul class="nav navbar-nav">
					  <li > <a aria-expanded="false" role="button" href="../home">Live</a> </li>
					  <li class="dropdown active"> <a aria-expanded="false" role="button" href="#" class="dropdown-toggle">Vehicle Information<span class="caret"></span></a>
						<ul  role="menu" class="dropdown-menu">
						  <li ><a href="VehicleView.html"><i class="fa fa-eye"></i> Vehicle View</a></li>
						  <li class="active"><a href="VehicleInfo_map_view.html"><i class="fa fa-thumb-tack"></i> Vehicle Map View</a></li>
						  <li ><a href="Vehicle_master_view.html"><i class="fa fa-info-circle"></i> Vehicle information </a></li>
						  <li><a href="#"><i class="fa fa-list-ul"></i> Vehicle I/O List</a></li>
						</ul>
					  </li>
					  <li> <a aria-expanded="false" role="button" href="reports.html">Reports</a> </li>
					  <li class="dropdown"> <a aria-expanded="false" role="button" href="#" class="dropdown-toggle" >Settings<span class="caret"></span></a>
						<ul role="menu" class="dropdown-menu">
						  <li ><a href="driver_scheduling_view.html"> <i class="fa fa-sitemap"></i> Driver Scheduling </a></li>
						  <li ><a href="vehicle_service_master_view.html"> <i class="fa fa-car"></i> Vehicle Service </a></li>
						  <li><a href="#"> <i class="fa fa-tencent-weibo"></i> Geofency</a></li>
						  <li><a href="fuel.html"> <i class="fa fa-tint"></i> Fuel </a></li>
						  <li><a href="location_master_entry.html"> <i class="fa fa-map-marker"></i> Location Entry </a></li>
						  <li ><a href="Route.html"> <i class="fa fa-road"></i> Route </a></li>
						  <li><a href="route_schedule_view.html"> <i class="fa fa-line-chart"></i> Route Scheduling </a></li>
						</ul>
					  </li>
					  <li class="dropdown"> <a aria-expanded="false" role="button" href="#" class="dropdown-toggle" >Configuration<span class="caret"></span></a>
						<ul role="menu" class="dropdown-menu">
						  <li ><a href="Vehicle_master_view.html"> <i class="fa fa-car"></i> Vehicle Master</a></li>
						  <li><a href="../DriverMasters"> <i class="fa fa-user"></i> Driver Details</a></li>
						  <li ><a href="group_master_view.html"> <i class="fa fa-bus"></i> Vehicle Groups</a></li>
						  <li ><a href="alert_master_view.html"> <i class="fa fa-bell-o"></i> Alert</a></li>
						  <li ><a href="../UserMasters"> <i class="fa fa-user"></i> User</a></li>
						  <li><a href="No_movements_view.html"> <i class="fa fa-dot-circle-o"></i> No Movement </a></li>
						</ul>
					  </li>
					  <li class="dropdown"> <a aria-expanded="false" role="button" href="#" class="dropdown-toggle" >School<span class="caret"></span></a>
						<ul role="menu" class="dropdown-menu">
						  <li><a href="student_master_view.html"> <i class="fa fa-child"></i> Student Entry </a></li>
						</ul>
					  </li>
					   <li class="dropdown"> <a aria-expanded="false" role="button" href="#" class="dropdown-toggle" >Help</a>
						
					  </li>
					</ul>
					<ul class="nav navbar-top-links navbar-right">
					  <li><span class="cust-name">Welcome to Test</span></li>
					  <li> <a href="../j_spring_security_logout"> <i class="fa fa-sign-out"></i> Log out </a> </li>
					</ul>
				  </div>
				</nav>
                </div>
            </div>
        </div>
    </div>
    <div id="page-wrapper2" class="gray-bg">
        <div class="rowx wrapper border-bottom white-bg page-heading">
            <div class="col-sm-6">
                <h2>Vehicle Map View</h2>
            </div>
            
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="wrapper wrapper-content animated fadeInUp">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-content">
                                    <div class="table-responsive">
                                        <table class="entrytable">
                                            <tbody>
                                                <div id="map_container" class="map_container"></div>

                                                <table id="entrydata" class="entrytable table table-striped table-bordered new-tbl">
													<thead>
														<tr class="leftMenu">
														<th></th>
														<th></th>
															<th>Vehicle No/ Name</th>
															<th>Fuel</th>
															<th>Status</th>
															<th>Speed</th>
															<th>A/c</th>
															<th>ODO(KM)</th>
															<th>Location</th>
															<th>No Movement</th>
															<th>Last Update Time</th>
															<th>Unit No</th>
														
														</tr>
													</thead>
													<tbody id="kk">
													  <td><i class="fa fa-pencil-square-o iconedit"  aria-hidden="true"></i></td>
															<td>&nbsp;&nbsp;<i  class="fa fa-trash  icondelete" aria-hidden="true"></i></td>
												
														<td>8569</td>
															<td>60</td>
															<td>Ignition on</td>
															<td>50</td>
															<td>5632</td>
															<td>90</td>
															<td>satara</td>
															<td>moving</td>
															<td>4.65</td>
															<td>50202</td>
												</tbody>

                                                </table>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="foot-fixed">
        <div class="auto-reloader-bar">
            <div class="row">
                <div class="col-xs-6">
                </div>
                <div class="col-xs-6 text-right">
                    <div class="copy-txt"><strong>Copyright</strong> Neha Software Technologies &copy; 2016 </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script type="text/javascript">
    var xmlHttpRequest = new XMLHttpRequest();
    function getRouteData(id) {
        xmlHttpRequest.open("get", "/TrackMeWeb/TrackMeServlet?action=getRoute&id=" + id, true);
        xmlHttpRequest.onreadystatechange = addRoute;
        xmlHttpRequest.send(null);
    }

    function addRoute() {
        var dom = (new DOMParser()).parseFromString(xmlHttpRequest.responseText, "text/xml");
        var data1 = dom.getElementsByTagName("vehicle");
        if (xmlHttpRequest.readyState == 4 && xmlHttpRequest.status == 200) {
            if (data1.length > 0) {

                var map = new google.maps.Map(document.getElementById('map_container'), {
                    zoom: 8,
                    center: { lat: parseFloat(data1[0].childNodes[0].firstChild.nodeValue), lng: parseFloat(data1[0].childNodes[1].firstChild.nodeValue) },
                    mapTypeId: google.maps.MapTypeId.HYBRID
                });
                var flightPlanCoordinates = [];
                var i = 0;
                var userCoor = [];
                while (i < data1.length) {

                    var latlng = new google.maps.LatLng({ lat: parseFloat(data1[i].childNodes[0].firstChild.nodeValue), lng: parseFloat(data1[i].childNodes[1].firstChild.nodeValue) });
                    flightPlanCoordinates.push(latlng);
                    userCoor.push([data1[i].childNodes[2].firstChild.nodeValue, parseFloat(data1[i].childNodes[0].firstChild.nodeValue), parseFloat(data1[i].childNodes[1].firstChild.nodeValue)]);
                    i++;
                }
                var flightPath = new google.maps.Polyline({
                    path: flightPlanCoordinates,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });

                flightPath.setMap(map);
                var infowindow = new google.maps.InfoWindow();

                var marker, i;

                for (i = 0; i < userCoor.length; i++) {
                    marker = new google.maps.Marker({
                        position: new google.maps.LatLng(userCoor[i][1], userCoor[i][2]),
                        map: map,
                        icon: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
                    });
                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                        return function () {
                            infowindow.setContent(userCoor[i][0]);
                            infowindow.open(map, marker);
                        }
                    })(marker, i));
                }


            }
        }

    }
    function addRowHandlers() {
        var table = document.getElementById("entrydata");
        var rows = $("#entrydata tbody tr");
        for (i = 0; i < rows.length; i++) {
            var currentRow = table.rows[i];
            var createClickHandler =
                function (row) {
                    return function () {
                        var cell = row.getElementsByTagName("td")[9];
                        var id = cell.innerHTML;
                        getRouteData(id);
                    };
                };

            currentRow.onclick = createClickHandler(currentRow);
        }
    }

    function loadMap() {

        xmlHttpRequest.open("get", "/TrackMeWeb/TrackMeServlet?action=getVehicleLocations", true);
        xmlHttpRequest.onreadystatechange = addDataToPage;
        xmlHttpRequest.send(null);

        function addDataToPage() {
            if (xmlHttpRequest.readyState == 4 && xmlHttpRequest.status == 200) {

                var table = document.getElementsByTagName("tbody");
                var dom = (new DOMParser()).parseFromString(xmlHttpRequest.responseText, "text/xml");
                var data = dom.getElementsByTagName("vehicle");
                var i = 0;
                while (i < data.length) {
                    row = table.insertRow(i + 1);
                    row.className = "leftMenu";
                    cell = row.insertCell(0);
                    cell.innerHTML = data[i].childNodes[0].firstChild.nodeValue;
                    cell = row.insertCell(1);
                    cell.innerHTML = data[i].childNodes[1].firstChild.nodeValue;
                    cell = row.insertCell(2);
                    cell.innerHTML = data[i].childNodes[2].firstChild.nodeValue;
                    cell = row.insertCell(3);
                    cell.innerHTML = data[i].childNodes[3].firstChild.nodeValue;
                    cell = row.insertCell(4);
                    cell.innerHTML = data[i].childNodes[4].firstChild.nodeValue;
                    cell = row.insertCell(5);
                    cell.innerHTML = data[i].childNodes[5].firstChild.nodeValue;
                    cell = row.insertCell(6);
                    cell.innerHTML = data[i].childNodes[6].firstChild.nodeValue;
                    cell = row.insertCell(7);
                    cell.innerHTML = data[i].childNodes[7].firstChild.nodeValue;
                    cell = row.insertCell(8);
                    cell.innerHTML = data[i].childNodes[8].firstChild.nodeValue;
                    cell = row.insertCell(9);
                    cell.innerHTML = data[i].childNodes[9].firstChild.nodeValue;
                    i++;
                }
                var infowindow = new google.maps.InfoWindow();
                if (data.length > 0) {
                    var i = 0;
                    var markers = [];
                    var latlng = new google.maps.LatLng({ lat: parseFloat(data[0].childNodes[11].firstChild.nodeValue), lng: parseFloat(data[0].childNodes[10].firstChild.nodeValue) });
                    var map = new google.maps.Map(document.getElementById("map_container"), {
                        zoom: 4,
                        mapTypeId: google.maps.MapTypeId.HYBRID,
                        center: latlng,
                    });
                    while (i < data.length) {
                        var unitno = data[i].childNodes[9].firstChild.nodeValue;
                        var location = data[i].childNodes[6].firstChild.nodeValue;
                        var lati = data[i].childNodes[11].firstChild.nodeValue;
                        var lon = data[i].childNodes[10].firstChild.nodeValue;
                        var ltlng = new google.maps.LatLng({ lat: parseFloat(lati), lng: parseFloat(lon) });
                        markers.push(new google.maps.Marker(
                                {
                                    position: ltlng,
                                    map: map,
                                    title: (location).toString()
                                }));
                        i++;
                    }
                }
            }
            addRowHandlers();
        }
    }
    $(document).ready(function () {
        $('#entrydata').DataTable({
        	dom: 'Bfrtp',
			ordering:false,
            buttons: [
						'excelHtml5',
						'pdfHtml5'
            ]
        });
        if ($("input[type='search']").length > 0) {
            $("input[type='search']").addClass("form-control");
        }
        if ($("select[name='entrydata_length']").length > 0) {
            $("select[name='entrydata_length']").addClass("form-control");
        }
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
    });

</script>
</html>

<script>
            $(document).ready(function () {
			
			$(".dt-buttons").addClass("pull-right");
					$("#entrydata_filter").addClass("pull-left");
                
            });
            
            
   		 $( document ).ready(function() {
   			    


   			    $(".buttons-html5").removeClass("dt-button");
   			    $(".buttons-html5").html("");
   			    $(".buttons-pdf").addClass("fa-file-pdf-o");
   			    $(".buttons-excel").addClass("fa-file-excel-o");
   			        $(".fa-file-pdf-o").addClass(".buttons-pdf");
   			            $(".fa-file-excel-o").addClass(".buttons-excel");
   			        
   			    
   			$(".buttons-excel::before").css("font-size","23px !important");
   			$(".buttons-excel::before").css("padding-left","17px !important");

   			$(".buttons-pdf::before").css("font-size","23px !important");
   			$(".buttons-pdf::before").css("padding-left","10px !important");

   			$(".table-responsive").css("position","relative");

   			$(".dt-buttons").css("position","absolute");
   			$(".dt-buttons").css("left","20%");
   			$(".dt-buttons").css("top","2px");
   			$(".input-sm").css("height","25px");

   			});
        </script> 